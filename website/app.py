#!/usr/bin/env python3

from __future__ import annotations

from vulnerabilitylookup.default import get_config
from website.web import commands
from website.web.api.v1 import apiv1_blueprint
from website.web.bootstrap import application


# ##### Registering blueprints
with application.app_context():
    from website.web import views

    application.register_blueprint(views.home_bp)
    application.register_blueprint(views.documentation_bp)
    if get_config("generic", "user_accounts"):
        application.config["user_accounts"] = True
        application.register_blueprint(views.admin_bp)
        application.register_blueprint(views.user_bp)
        application.register_blueprint(views.users_bp)
        application.register_blueprint(views.comment_bp)
        application.register_blueprint(views.comments_bp)
        application.register_blueprint(views.bundle_bp)
        application.register_blueprint(views.bundles_bp)
        application.register_blueprint(views.sighting_bp)
        application.register_blueprint(views.sightings_bp)

    # API v1
    application.register_blueprint(apiv1_blueprint)


# ##### Registering commands

application.cli.add_command(commands.db_init)
application.cli.add_command(commands.db_backup)
application.cli.add_command(commands.create_admin)
application.cli.add_command(commands.create_user)
application.cli.add_command(commands.user_list)
application.cli.add_command(commands.user_delete)
application.cli.add_command(commands.user_get_api_key)
application.cli.add_command(commands.update_warninglists)

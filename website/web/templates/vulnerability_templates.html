{% from 'bootstrap5/utils.html' import render_icon %}
{% macro collapse_raw(source, vulnerability_id, vulnerability_data) %}
<br /><br />
<div class="btn-group" role="group">
  <a role="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#collapseJson{{vulnerability_id}}" aria-expanded="false" aria-controls="collapseJson{{vulnerability_id}}">
    JSON {{ render_icon('chevron-down') }}
  </a>
  <div class="btn-group" role="group">
    <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Share {{ render_icon('chevron-down') }}
    </button>
    <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
      <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&t=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
      <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
      <li><a class="dropdown-item" href="https://mastodonshare.com/?text=Vulnerability {{ vulnerability_id }}&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}" target="_blank" title="Share on Mastodon">Mastodon</a></li>
      <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
      <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&description=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Pinboard">Pinboard</a></li>
      <li><a class="dropdown-item" href="https://reddit.com/submit?link=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
  {% if config.user_accounts and current_user.is_authenticated %}
  <div class="btn-group" role="group">
    <button id="btnGroupDropSighting{{vulnerability_id}}" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Add a sighting {{ render_icon('chevron-down') }}
    </button>
    <ul id="sighting-list" class="dropdown-menu" aria-labelledby="btnGroupDropSighting{{vulnerability_id}}">
      <li><a class="dropdown-item" title="Seen" aria-label="Seen" value="seen" href="#sightings">Seen</a></li>
      <li><a class="dropdown-item" title="Confirmed" aria-label="Confirmed" value="confirmed" href="#sightings">Confirmed</a></li>
      <li><a class="dropdown-item" title="Exploited" aria-label="Exploited" value="exploited" href="#sightings">Exploited</a></li>
      <li><a class="dropdown-item" title="Patched" aria-label="Patched" value="patched" href="#sightings">Patched</a></li>
      <li><a class="dropdown-item" title="Not exploited" aria-label="Not exploited" value="not-exploited" href="#sightings">Not exploited</a></li>
      <li><a class="dropdown-item" title="Not confirmed" aria-label="Not confirmed" value="not-confirmed" href="#sightings">Not confirmed</a></li>
      <li><a class="dropdown-item" title="Not patched" aria-label="Not patched" value="not-patched" href="#sightings">Not patched</a></li>
    </ul>
  </div>
  {% endif %}
  <a type="button" class="btn btn-primary" title="Copy to clipboard" aria-label="Copy to clipboard" onclick="copyToClipboard('{{vulnerability_id}}')" vuln-id="{{vulnerability_id}}" href="#">To clipboard</a>
  {% if  config.user_accounts and current_user.is_authenticated and source in ["cvelistv5", local_instance_name]  %}
  <a role="button" class="btn btn-primary" title="Edit the object" aria-label="Edit the vulnerability" href="{{ url_for('user_bp.vulnogram', vulnerability_id=vulnerability_id) }}">Edit</a>
  {% endif %}
  {% if config.user_accounts and current_user.is_authenticated and source == local_instance_name  %}
  <a role="button" class="btn btn-danger" id="deleteVulnerability" type="button" href="#">Delete</a>
  {% endif %}
</div>

<div class="collapse" id="collapseJson{{vulnerability_id}}">
  <br />
  <div class="card card-body">
    <pre class="json-container" id="container{{vulnerability_id}}">{{vulnerability_data|tojson(indent=2)}}</pre>
  </div>
</div>
{%- endmacro %}

{% macro unpublished(vulnerability_id) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <p class="card-text">
      This vulnerability hasn't been published yet, but you're welcome to add your comments in advance.
    </p>
    <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Share {{ render_icon('chevron-down') }}
    </button>
    <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
      <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&t=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
      <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
      <li><a class="dropdown-item" href="https://mastodonshare.com/?text=Vulnerability {{ vulnerability_id }}&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}" target="_blank" title="Share on Mastodon">Mastodon</a></li>
      <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
      <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&description=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Pinboard">Pinboard</a></li>
      <li><a class="dropdown-item" href="https://reddit.com/submit?link=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
</div>
{%- endmacro %}

{% macro cisa_known_exploited_view(data) -%}
<div class="card">
  <div class="card-body">
    <h5 class="card-title">CISA Known exploited vulnerability</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Data from the <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" rel="noreferrer" target="_blank">Known Exploited Vulnerabilities Catalog</a>
    </h6>
    <p class="card-text">Date added: {{data['dateAdded']}}</p>
    <p class="card-text">Due date: {{data['dueDate']}}</p>
    <p class="card-text">Required action: {{data['requiredAction']}}</p>
    <p class="card-text">Used in ransomware: {{data['knownRansomwareCampaignUse']}}</p>
    {%if data['notes'] %}
    <p class="card-text">Notes: {{data['notes']}}</p>
    {%endif%}
  </div>
</div>
{%- endmacro %}

{% macro nvd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://nvd.nist.gov/vuln" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['cve']['descriptions'][0]['value']}}</p>
    {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
    {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro cvelistv5_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/CVEProject/cvelistV5" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {% endfor %}
      {% endif %}
    {% else %}
      <div class="row">
          <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['cveMetadata']['datePublished'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
      </div>
      <div class="row">
          <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['cveMetadata']['dateUpdated'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
      </div>
      {% set severity_css = {"Low": "bg-success rounded px-1", "Medium": "bg-warning rounded px-1 text-dark", "High": "bg-danger rounded px-1 text-light", "Critical": "bg-danger rounded px-1 text-light"} %}
      {# trying to find the CVSS metric in cna.metrics #}
      {% if 'cna' in vulnerability_data['containers'] or 'adp' in vulnerability_data['containers'] %}
      <div class="row">
        <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="right" title="The Common Vulnerability Scoring System (CVSS) provides a way to capture the principal characteristics of a vulnerability and produce a numerical score reflecting its severity.">Severity <span style="color: green;">?</span></div>
        <div class="col">
          {% if 'cna' in  vulnerability_data['containers'] and 'metrics' in vulnerability_data['containers']['cna']  %}
            {% set metrics = vulnerability_data['containers']['cna']['metrics'] %}
          {% elif 'adp' in  vulnerability_data['containers'] %}
            {% set break = False %}
            {% set ns = namespace(metrics = []) %}
            {% for elem in vulnerability_data['containers']['adp'] %}
              {% if not break and 'metrics' in elem %}
                {% set ns.metrics = elem['metrics'] %}
                {% set break = True %}
              {% endif %}
            {% endfor %}
            {% set metrics = ns.metrics %}
          {% endif %}
          {% if metrics %}
            {% for metric in metrics %}
              {% if 'cvssV3_1' in metric or 'cvssV3_0' in metric or 'cvssV4_0' in metric  %}
                {% if 'vectorString' in metric['cvssV3_1'] %}
                  {% set vectorString = metric['cvssV3_1']['vectorString'] %}
                  {% set version = 'cvssV3_1' %}
                  {% set version_short = '3.1' %}
                {% endif %}
                {% if 'vectorString' in metric['cvssV3_0'] %}
                  {% set vectorString = metric['cvssV3_0']['vectorString'] %}
                  {% set version = 'cvssV3_0' %}
                  {% set version_short = '3.0' %}
                {% endif %}
                {% if 'vectorString' in metric['cvssV4_0'] %}
                  {% set vectorString = metric['cvssV4_0']['vectorString'] %}
                  {% set version = 'cvssV4_0' %}
                  {% set version_short = '4.0' %}
                {% endif %}
                  <span class="{{ severity_css[vectorString | cvss_severity(version)] }}">{{ vectorString | cvss_base_score(version) }} ({{ vectorString | cvss_severity(version) }})</span> - <a href="https://www.first.org/cvss/calculator/{{ version_short }}#{{ vectorString | cvss_clean_vector(version) }}" rel="noreferrer" target="_blank">{{ vectorString | cvss_clean_vector(version) }}</a><br />
              {% endif %}
            {% endfor %}
            {% endif %}
        </div>
      </div>
      {% else %}
      {# trying to find the CVSS metric in meta.nvd #}
        <div class="row">
          <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="right" title="The Common Vulnerability Scoring System (CVSS) provides a way to capture the principal characteristics of a vulnerability and produce a numerical score reflecting its severity.">Severity <span style="color: green;">?</span></div>
          <div class="col">
          {% set data = vulnerability_data['meta']['nvd'] | str_to_obj %}
          {% if 'metrics' in data['cve'] %}
            {% if 'cvssMetricV31' in data['cve']['metrics'] %}
              {% set version = 'cvssV3_1' %}
              {% set version_short = '3.1' %}
              {% set key = 'cvssMetricV31' %}
            {% elif 'cvssMetricV30' in data['cve']['metrics'] %}
              {% set version = 'cvssV3_0' %}
              {% set version_short = '3.0' %}
              {% set key = 'cvssMetricV30' %}
            {% elif 'cvssMetricV40' in data['cve']['metrics'] %}
              {% set version = 'cvssV4_0' %}
              {% set version_short = '4.0' %}
              {% set key = 'cvssMetricV40' %}
            {% endif %}
            {% for metric in data['cve']['metrics'][key] %}
              {% set vectorString = metric['cvssData']['vectorString'] %}
              <span class="{{ severity_css[vectorString | cvss_severity(version)] }}">{{ vectorString | cvss_base_score(version) }} ({{ vectorString | cvss_severity(version) }})</span> - <a href="https://www.first.org/cvss/calculator/{{ version_short }}#{{ vectorString | cvss_clean_vector(version) }}" rel="noreferrer" target="_blank">{{ vectorString | cvss_clean_vector(version) }}</a><br />
            {% endfor %}
          {% endif %}
        </div>
      </div>
      {% endif %}
      <div class="row" hidden>
        <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="left" title="Exploit Prediction Scoring System (EPSS) from FIRST. The EPSS score is representing the probability of exploitation in the wild in the next 30 days.">EPSS score <span style="color: green;">?</span></div>
        <div class="col">
          <span id="epss-score"></span>
          <span id="epss-percentile" style="text-decoration:underline dotted" data-bs-toggle="tooltip" data-bs-placement="right" title="The percentile of the current score, the proportion of all scored vulnerabilities with the same or a lower EPSS score."></span>
        </div>
      </div>
      {% if vulnerability_data['containers']['cna']['title'] %}
        <div class="row">
          <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['containers']['cna']['title']}}</div>
        </div>
      {% else %}
        <div class="row">
          <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</div>
        </div>
      {% endif %}
      {% if 'meta' in vulnerability_data and 'nvd' in vulnerability_data['meta']  %}
        <div class="row">
          <div class="col-md-2 fw-bold">References</div>
          <div class="col">
            {% set data = vulnerability_data['meta']['nvd'] | str_to_obj %}
            <table class="table table-borderless table-hover">
              <thead>
                <tr data-bs-toggle="collapse" data-bs-target="#collapseReferenceTable{{ vulnerability_id }}" aria-expanded="false" aria-controls="collapseReferenceTable{{ vulnerability_id }}">
                  <th scope="col" style="width: 20px;"><span class="chevron" >▼</span></th><th scope="col">URL</th><th scope="col">Tags</th>
                </tr>
              </thead>
              <tbody class="collapse" id="collapseReferenceTable{{ vulnerability_id }}">
              {% for ref in data['cve']['references'] %}
                <tr><td></td><td><a href="mailto:{{ ref.source }}">{{ ref.source }}</a></td><td><a href="{{ ref.url }}" rel="noreferrer" target="_blank">{{ ref.url }}</a></td><td>{{ ref.tags | join(', ')  }}</td></tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% elif 'references' in vulnerability_data['containers']['cna'] %}
        <div class="row">
          <div class="col-md-2 fw-bold">References</div>
          <div class="col">
            <table class="table table-borderless table-hover">
            <thead>
              <tr data-bs-toggle="collapse" data-bs-target="#collapseReferenceTable{{ vulnerability_id }}" aria-expanded="false" aria-controls="collapseReferenceTable{{ vulnerability_id }}">
                <th scope="col" style="width: 20px;"><span class="chevron" >▼</span></th><th scope="col">URL</th><th scope="col">Tags</th>
              </tr>
            </thead>
            <tbody class="collapse" id="collapseReferenceTable{{ vulnerability_id }}">
            {% for ref in vulnerability_data['containers']['cna']['references'] %}
              <tr><td></td><td><a href="{{ ref.url }}" rel="noreferrer" target="_blank">{{ ref.url }}</a></td><td>{{ ref.tags | join(', ')  }}</td></tr>
            {% endfor %}
            </table>
            </tbody>
          </div>
        </div>
      {% endif %}
      <div class="row">
        <div class="col-md-2 fw-bold">Impacted products</div>
        <div class="col">
          <table class="table table-borderless table-hover">
            <thead>
              <tr data-bs-toggle="collapse" data-bs-target="#collapseProductTable{{ vulnerability_id }}" aria-expanded="false" aria-controls="collapseProductTable{{ vulnerability_id }}">
                <th scope="col" style="width: 20px;"><span class="chevron" >▼</span></th>
                <th scope="col">Vendor</th>
                <th scope="col">Product</th>
                <th scope="col">Version</th>
              </tr>
            </thead>
            <tbody class="collapse" id="collapseProductTable{{ vulnerability_id }}">
            {% for elem in vulnerability_data['containers']['cna']['affected'] %}
              <tr>
                <td></td>
                <td><a href="{{ url_for('home_bp.search', vendor=elem['vendor']) }}">{{ elem['vendor'] }}</a></td>
                <td><a href="{{ url_for('home_bp.search', vendor=elem['vendor'], product=elem['product']) }}">{{ elem['product'] }}</a></td>
                <td>
                  {% for version in elem['versions'] %}

                    {% if version['status']=='affected' %}
                      {% if version['versionType'] == 'semver'  %}
                        <b>Version:</b> {{ version['version'] }} &nbsp;&nbsp;<b>&leq;</b> {{ version['lessThanOrEqual'] }}<br />
                      {% elif version['versionType'] == 'custom'  %}
                        <b>Version:</b> {{ version['version'] }} &nbsp;&nbsp;<b>&lt;</b> {{ version['lessThan'] }}<br />
                      {% else  %}
                        <b>Version:</b> {{ version['version'] }}<br />
                      {% endif %}

                    {% elif version['status']=='unaffected' %}
                      {% if version['versionType'] == 'custom'  %}
                        <b>Patch:</b> {{ version['version'] }}<br />
                      {% endif %}
                    {% endif %}
                  {% endfor %}

                  {% for cpe in elem['cpes'] %}
                    &nbsp;&nbsp;&nbsp;&nbsp;{{ cpe }}
                  {% endfor %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% if 'cisa_known_exploited' in vulnerability_data['meta'] %}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {% endif %}
    {% endif %}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on NVD website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro circl_view(source, vulnerability_id, vulnerability_data, current_user) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from {{source}}
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro github_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/advisories" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['published'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    {% if 'severity' in vulnerability_data and vulnerability_data['severity'] %}
    <div class="row">
      <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="right" title="The Common Vulnerability Scoring System (CVSS) provides a way to capture the principal characteristics of a vulnerability and produce a numerical score reflecting its severity.">Severity <span style="color: green;">?</span></div>
      <div class="col">
        {% set severity_css = {"Low": "bg-success rounded px-1", "Medium": "bg-warning rounded px-1 text-dark", "High": "bg-danger rounded px-1 text-light", "Critical": "bg-danger rounded px-1 text-light"} %}
        {% set versions = {"CVSS_V3": "3.1", "CVSS_V4": "4.0"} %}
        {% for severity in vulnerability_data['severity'] %}
          <span class="{{ severity_css[severity['score'] | cvss_severity(severity['type'])] }}">{{ severity['score'] | cvss_base_score(severity['type']) }} ({{ severity['score'] | cvss_severity(severity['type']) }})</span> - <a href="https://www.first.org/cvss/calculator/{{ versions[severity['type']] }}#{{ severity['score'] | cvss_clean_vector(severity['type']) }}" rel="noreferrer" target="_blank">{{ severity['score'] | cvss_clean_vector(severity['type']) }}</a><br />
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% if 'summary' in vulnerability_data  %}
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{ vulnerability_data['summary'] }}</div>
    </div>
    {% endif %}
    {% if 'details' in vulnerability_data  %}
    <div class="row">
      <div class="col-md-2 fw-bold">Details</div><div class="col">{{ vulnerability_data['details'] | markdown | safe }}</div>
    </div>
    {% endif %}
    <a href="https://github.com/advisories/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro ossf_malicious_packages_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/ossf/malicious-packages" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{ vulnerability_data['summary'] }}</p>
    <p class="card-text">{{ vulnerability_data['details'] | markdown | safe }}</p>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_siemens_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.siemens.com/global/en/products/services/cert.html" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_certbund_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://wid.cert-bund.de/portal/wid/start" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_redhat_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://access.redhat.com/security/" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisa_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisa.gov" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisco_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisco.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_sick_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.sick.com/psirt"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_ox_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://open-xchange.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, ulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_nozominetworks_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://security.nozominetworks.com/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro gsd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://gsd.id" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {% if 'gsd' in vulnerability_data %}
      <div class="row">
        <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['gsd']['osvSchema']['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
      </div>
      <div class="row">
        <div class="col-md-2 fw-bold">Details</div>
        {% if 'details' in vulnerability_data['gsd']['osvSchema'] %}
          <div class="col">{{ vulnerability_data['gsd']['osvSchema']['details'] }}</div>
        {% else  %}
          {% set namespaces = ['cisa.gov', 'cve.org', 'gitlab.com', 'nvd.nist.gov'] %}
          {% set languages = ['eng'] %}
          {% for namespace in namespaces %}
          {% if vulnerability_data['namespaces'].get(namespace, false)  %}
            {% if 'description' in vulnerability_data['namespaces'][namespace] %}
              {% for item in vulnerability_data['namespaces'][namespace]['description']['description_data'] %}
                {% if item['lang'] in languages %}
                <div class="col">{{ item['value'] }}</div>
                {% endif %}
              {% endfor %}
            {% endif %}
          {% endif %}
          {% endfor %}
        {% endif %}
      </div>
      {% if 'aliases' in vulnerability_data['gsd']['osvSchema'] %}
      <div class="row">
        <div class="col-md-2 fw-bold">Aliases</div>
        <div class="col">
          <ul class="list-group list-group-flush">
            {% for alias in vulnerability_data['gsd']['osvSchema']['aliases'] %}
            <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=alias) }}">{{ alias }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endif %}
    {% endif %}
    {% if 'GSD' in vulnerability_data and 'alias' in vulnerability_data['GSD'] %}
      <div class="row">
        <div class="col-md-2 fw-bold">Aliases</div>
        <div class="col">
          <a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_data['GSD']['alias']) }}">{{ vulnerability_data['GSD']['alias'] }}</a>
        </div>
      </div>
      {% endif %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro pysec_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/pypa/advisory-database" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['published'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
        <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    {% if 'severity' in vulnerability_data and vulnerability_data['severity'] %}
    <div class="row">
      <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="right" title="The Common Vulnerability Scoring System (CVSS) provides a way to capture the principal characteristics of a vulnerability and produce a numerical score reflecting its severity.">Severity <span style="color: green;">?</span></div>
      <div class="col">
        {% set severity_css = {"Low": "bg-success rounded px-1", "Medium": "bg-warning rounded px-1 text-dark", "High": "bg-danger rounded px-1 text-light", "Critical": "bg-danger rounded px-1 text-light"} %}
        {% set versions = {"CVSS_V3": "3.1", "CVSS_V4": "4.0"} %}
        {% for severity in vulnerability_data['severity'] %}
          <span class="{{ severity_css[severity['score'] | cvss_severity(severity['type'])] }}">{{ severity['score'] | cvss_base_score(severity['type']) }} ({{ severity['score'] | cvss_severity(severity['type']) }})</span> - <a href="https://www.first.org/cvss/calculator/{{ versions[severity['type']] }}#{{ severity['score'] | cvss_clean_vector(severity['type']) }}" rel="noreferrer" target="_blank">{{ severity['score'] | cvss_clean_vector(severity['type']) }}</a><br />
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <div class="row">
        <div class="col-md-2 fw-bold">Details</div><div class="col">{{ vulnerability_data['details'] | markdown | safe }}</div>
    </div>
    {% if 'aliases' in vulnerability_data %}
    <div class="row">
      <div class="col-md-2 fw-bold">Aliases</div>
      <div class="col">
        <ul class="list-group list-group-flush">
          {% for alias in vulnerability_data['aliases'] %}
          <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=alias) }}">{{ alias }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro variot_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.variotdbs.pl/vulns/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {% if 'description' in vulnerability_data %}<p class="card-text">{{ vulnerability_data['description']['data'] | markdown | safe }}</p>{% endif %}
    <a href="https://www.variotdbs.pl/vuln/{{vulnerability_id|upper}}" class="card-link"  rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro tailscale_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://tailscale.com/security-bulletins"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {# if the vulnerability_data['summary_detail']['type'] == text/html, it has been sanitized - https://feedparser.readthedocs.io/en/latest/html-sanitization.html #}
    <p class="card-text">
      {% if vulnerability_data['summary_detail']['type'] == "text/html" %}
      {{ vulnerability_data['summary'] | safe}}
      {% else %}
      {{ vulnerability_data['summary']}}
      {%endif%}
    </p>
    <a href="{{ vulnerability_data['link'] }}" class="card-link"  rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro jvndb_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://jvndb.jvn.jp/en/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
        <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['dcterms:issued'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
        <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['dcterms:modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    {% if vulnerability_data['sec:cvss'] %}
    {% set severity_css = {"Low": "bg-success rounded px-1", "Medium": "bg-warning rounded px-1 text-dark", "High": "bg-danger rounded px-1 text-light", "Critical": "bg-danger rounded px-1 text-light"} %}
    <div class="row">
      <div class="col-md-2 fw-bold" data-bs-toggle="tooltip" data-bs-placement="right" title="The Common Vulnerability Scoring System (CVSS) provides a way to capture the principal characteristics of a vulnerability and produce a numerical score reflecting its severity.">Severity <span style="color: green;">?</span></div>
      <div class="col">
        {% if vulnerability_data['sec:cvss'] %}
         {% set cvss_ns = namespace(found=false) %}
         {% if vulnerability_data['sec:cvss'] is mapping %}
          {% if vulnerability_data['sec:cvss']['@version'] == '3.0' %}
            {% set cvss_ns.vectorString = vulnerability_data['sec:cvss']['@vector'] %}
            {% set cvss_ns.version = 'cvssV3_0' %}
            {% set cvss_ns.version_short = '3.0' %}
          {% endif %}
         {% else %}
          {% for metric in vulnerability_data['sec:cvss'] %}
           {% if metric['@version'] == '3.0' %}
            {% set cvss_ns.vectorString = metric['@vector'] %}
            {% set cvss_ns.version = 'cvssV3_0' %}
            {% set cvss_ns.version_short = '3.0' %}
           {% endif %}
          {% endfor %}
         {% endif %}
         <span class="{{ severity_css[cvss_ns.vectorString | cvss_severity(cvss_ns.version)] }}">
           {{ cvss_ns.vectorString | cvss_base_score(cvss_ns.version) }} ({{ cvss_ns.vectorString | cvss_severity(cvss_ns.version) }})
         </span> - {{ cvss_ns.version }} -
         <a href="https://www.first.org/cvss/calculator/{{ cvss_ns.version_short }}#{{ cvss_ns.vectorString | cvss_clean_vector(cvss_ns.version) }}" rel="noreferrer" target="_blank">
           {{ cvss_ns.vectorString | cvss_clean_vector(cvss_ns.version) }}
         </a>
         <br />
        {% endif %}
      </div>
    </div>
    {% endif %}
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{ vulnerability_data['title'] }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Details</div><div class="col">{{ vulnerability_data['description'] }}</div>
    </div>
    {% if 'sec:references' in vulnerability_data and vulnerability_data['sec:references'] is sequence %}
      <div class="row">
        <div class="col-md-2 fw-bold">References</div>
        <div class="col">
          <table class="table">
          <thead>
            <tr data-bs-toggle="collapse" data-bs-target="#collapseReferenceTable{{ vulnerability_id }}" aria-expanded="false" aria-controls="collapseReferenceTable{{ vulnerability_id }}">
              <th scope="col" style="width: 20px;"><span class="chevron" >▼</span></th><th scope="col">Type</th><th scope="col">URL</th>
            </tr>
          </thead>
          <tbody class="collapse" id="collapseReferenceTable{{ vulnerability_id }}">
          {% for ref in vulnerability_data['sec:references'] %}
            <tr>
              <td></td>
              {% if ref['@title'] %}
              <td>{{ ref['@title'] }}</td>
              {% else %}
              <td>{{ ref['@source'] }}</td>
              {% endif %}
              <td><a href="{{ ref['#text'] }}" rel="noreferrer" target="_blank">{{ ref['#text'] }}</a></td>
            </tr>
          {% endfor %}
          </tbody>
          </table>
        </div>
      </div>
    {% endif %}
    <div class="row">
      <div class="col-md-2 fw-bold">Impacted products</div>
      <div class="col">
        <table class="table table-borderless table-hover caption-top">
          <thead>
            <tr data-bs-toggle="collapse" data-bs-target="#collapseProductTable{{ vulnerability_id }}" aria-expanded="false" aria-controls="collapseProductTable{{ vulnerability_id }}">
              <th scope="col" style="width: 20px;"><span class="chevron" >▼</span></th><th scope="col">Vendor</th><th scope="col">Product</th>
            </tr>
          </thead>
          <tbody class="collapse" id="collapseProductTable{{ vulnerability_id }}">
            {% if vulnerability_data['sec:cpe'] is mapping %}
            <tr><td></td><td><a href="{{ url_for('home_bp.search', vendor=vulnerability_data['sec:cpe']['@vendor']) }}">{{ vulnerability_data['sec:cpe']['@vendor'] }}</a></td><td><a href="{{ url_for('home_bp.search', vendor=vulnerability_data['sec:cpe']['@vendor'], product=vulnerability_data['sec:cpe']['@product']) }}">{{ vulnerability_data['sec:cpe']['@product'] }}</a></td></tr>
            {% else%}
            {% for elem in vulnerability_data['sec:cpe'] %}
              <tr><td></td><td><a href="{{ url_for('home_bp.search', vendor=elem['@vendor']) }}">{{ elem['@vendor'] }}</a></td><td><a href="{{ url_for('home_bp.search', vendor=elem['@vendor'], product=elem['@product']) }}">{{ elem['@product'] }}</a></td></tr>
            {% endfor %}
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
    <a href="{{vulnerability_data['link']}}" class="card-link"  rel="noreferrer" target="_blank">Show details on JVN DB website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

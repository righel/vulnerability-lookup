#!/usr/bin/env python3

from flask import abort
from flask import Blueprint
from flask import send_from_directory
from werkzeug import Response as WerkzeugResponse

from vulnerabilitylookup.default import get_homedir

# Define the blueprint
homedir = get_homedir()
static_folder = homedir.joinpath("docs/_build/html")
documentation_bp = Blueprint('documentation', __name__, url_prefix="/documentation", static_folder=static_folder)


@documentation_bp.route('/<path:filename>')
def serve_documentation(filename: str) -> WerkzeugResponse:
    """Serve static files from the Sphinx build folder."""
    if None is documentation_bp.static_folder:
        return abort(404)
    return send_from_directory(documentation_bp.static_folder, filename)


@documentation_bp.route('/')
def serve_index() -> WerkzeugResponse:
    """Redirect `/documentation` to `/documentation/index.html`"""
    if None is documentation_bp.static_folder:
        return abort(404)
    return send_from_directory(documentation_bp.static_folder, 'index.html')

#!/usr/bin/env python3

from __future__ import annotations

import time

from subprocess import Popen

from redis import Redis

from vulnerabilitylookup.default import get_homedir, get_socket_path


def main() -> None:
    # Just fail if the env isn't set.
    get_homedir()
    print('Request the website to stop…')
    r = Redis(unix_socket_path=get_socket_path('cache'), db=1)
    r.set('website_shutdown', 1)
    while r.zscore('running', 'website') is not None:
        print('Wait for the website to stop…')
        time.sleep(1)
    print('done.')
    r.delete('website_shutdown')

    print('Start website…')
    Popen(['start_website'])
    print('done.')


if __name__ == '__main__':
    main()
